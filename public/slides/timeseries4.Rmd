---
title: "IM532 3.0 Applied Time Series Forecasting"
subtitle: "MSc in Industrial Mathematics"
author: "Thiyanga Talagala"
date: "31 May 2020"
output:
  xaringan::moon_reader:
    chakra: libs/remark-latest.min.js
    lib_dir: libs
    css: 
      - default
      - default-fonts
      - duke-blue
      - hygge-duke
      - libs/cc-fonts.css
      - libs/figure-captions.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

## Time series decomposition

### Recall: Time series patterns

**Trend** ($T_t$)

Long-term increase or decrease in the data.


**Seasonal** ($S_t$)

A seasonal pattern exists when a series is influenced by seasonal factors (e.g., the quarter of the year, the month, or day of the week). Seasonality is always of a fixed and known period. Hence, seasonal time series are sometimes called periodic time series.

Period is unchanging and associated with some aspect of the calendar.

**Cyclic** 

A cyclic pattern exists when data exhibit rises and falls that are not of fixed period. The duration of these fluctuations is usually of at least 2 years.


<!--Not too much into theory. -->

---

# Time series decomposition

$$y_t = f(S_t, T_t, R_t)$$

$y_t$: data at period $t$.

$T_t$: trend-cycle component at period $t$.

$S_t$: seasonal component at period $t$.

$R_t$: remainder component at period $t$.

## Additive decomposition

$$y_t=S_t + T_t + R_t$$
## Multiplicative decomposition

$$y_t=S_t \times T_t \times R_t$$

To transform from multiplicative to additive, you can use a Box-Cox transformation (particularly, **log** transformation).

<!--Additive model appropriate if magnitude of **seasonal** fluctuations does not vary with level.-->

<!-- If **seasonal** are proportional to level of a series then multiplicative model appropriate.-->

<!-- Multiplicative decomposition more prevalent with economics models.-->

---
## Multiplicative vs. Additive

.pull-left[

## `AirPassengers`


```{r, comment=NA, message=FALSE, warning=FALSE, echo=FALSE}
library(forecast)
library(fpp2)
fit <- stl(AirPassengers, s.window = 12)
autoplot(fit)
```


]

.pull-right[


]

---
class: duke-orange, center, middle

# ExponenTial Smoothing Models (ETS models)

---

background-image: url('ETS.png')
background-position: center
background-size: contain


---

# Introduction

## Naive approach

$$\hat{y}_{t+h|t} = y_t$$


## Average method 

$$\hat{y}_{t+h|T} = \bar{y}=(y_1 + y_2 + ... + y_t)/t$$


## Exponential smoothing method

$$\hat{Y}_{t+1|t}=\alpha y_t + (1-\alpha) \hat{Y}_T$$

where $0 < \alpha < 1$.

$$\text{New forecast} = [\alpha \times \text{New observed value}] + [(1-\alpha) \times \text{Previous forecast}]$$
$\alpha$ - smoothing constant
---

# Exponential Smoothing Method


\begin{eqnarray}
\hat{Y}_{t+1|t} & = & \alpha y_t + (1-\alpha) \hat{Y}_t\\
& = & \alpha y_t + (1-\alpha)[\alpha y_{t-1} + (1-\alpha)\hat{Y}_{t-1}]\\
& = & \alpha y_t + \alpha (1-\alpha) y_{t-1} + (1-\alpha)^2\hat{Y}_{t-1}
\end{eqnarray}
--
Continued substitution for $\hat{Y}_{t-1}$ and so forth shows $\hat{Y}_{t+1}$ can be written as a sum of current and previous $y$'s with exponentially declining weights.

$$\hat{Y}_{t+1|t}=\alpha y_t + \alpha(1-\alpha)y_{t-1}+\alpha(1-\alpha)^2y_{t-2}+\alpha(1-\alpha)^3y_{t-3}+...$$
--
The speed at which past observations lose their impact depends on the value of $\alpha$.

--
The $\alpha$ producing the smallest forecast error is chosen for use in calculating future forecasts.

---

# Comparison of different values for $\alpha$

Period| $\alpha=0.1$| $\alpha=0.6$ 
---|:---:|:---:|
$t$| $.100$ | $.900$
$t-1$| $.9 \times .1=.090$ | $.4 \times .6=.240$
$t-2$| $.9 \times .9 \times .1=.081$ | $.4 \times.4 \times .6=.096$
$t-3$| $.9 \times .9 \times .9 \times .1=.073$ | $.4 \times .4 \times.4 \times .6=.038$
$t-4$| $.9 \times .9 \times .9 \times .9 \times .1=.066$ | $.4 \times .4 \times .4 \times .4 \times .6=.015$
$.$| $.$ | $.$
$.$| $.$ | $.$
$.$| $.$ | $.$

--

**Factors that affects the values of forecasts**

$$\hat{Y}_{t+1|t}=\alpha y_t + \alpha(1-\alpha)y_{t-1}+\alpha(1-\alpha)^2y_{t-2}+\alpha(1-\alpha)^3y_{t-3}+...$$

- choice of $\alpha$

- initial value $y_t$

<!--The influence of the initial forecast diminishes greatly as t increases.-->

---

# Example 


---

# Single Exponential Smoothing (SES)

## Component form

**Forecasting equation**

$$\hat{Y}_{t+1|t}=l_t$$

**Smoothing equation**

$$l_t=\alpha y_{t} + (1-\alpha)l_{t-1}$$

## Weighted average form

$$\hat{Y}_{t+1|t}=\sum_{j=0}^{t-1} \alpha (1-\alpha)^j y_{t-j} + (1-\alpha)^tl_0$$

---

# How to find $\alpha$ and $l_0$?

minimum SSE 

$$SSE = \sum_{t=1}^T (y_t - \hat{Y}_{t|t-1})^2=\sum_{t=1}^{T}e_t^2$$

---

# Example 

---
class: duke-orange, center, middle

# ExponenTial Smoothing Models (ETS models)

## Trend Methods


---

# Holt's linear trend

---

# Damped trend method

---
class: duke-orange, center, middle

# ExponenTial Smoothing Models (ETS models)

## Seasonal Methods

---

class: duke-orange, center, middle

# Taxonomy

---
class: duke-orange, center, middle

# Automated ETS algorithm in R


